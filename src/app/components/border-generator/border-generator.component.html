<div class="border-generator-container">
  <!-- Upload/Settings Panel -->
  <div class="settings-panel">
    <div class="panel-content">
      <ng-container *ngIf="!uploadedImage; else settingsTemplate">
        <!-- Upload Area -->
        <div
          class="upload-area"
          [class.dragging]="isDragging"
          (dragover)="onDragOver($event)"
          (dragleave)="onDragLeave()"
          (drop)="onDrop($event)"
          (click)="openFileInput()">
          <div class="upload-text-container">
            <ion-icon name="images-outline" class="upload-icon"></ion-icon>
            <p class="upload-text">拖放圖片到此或點擊上傳</p>
          </div>
          <input
            #fileInput
            type="file"
            accept="image/*"
            (change)="onFileInputChange($event)"
            class="hidden-input" />
        </div>
      </ng-container>

      <ng-template #settingsTemplate>
        <!-- Settings Panel -->
        <div class="settings-content">
          <div class="settings-grid">
            <!-- Grid Count X -->
            <div class="setting-item">
              <label class="setting-label">
                寬度網格數: {{ settings.gridCountX }}
              </label>
              <input
                type="range"
                min="3"
                max="12"
                step="1"
                [value]="settings.gridCountX"
                (input)="updateSetting('gridCountX', +$any($event.target).value)"
                class="range-input" />
            </div>

            <!-- Grid Count Y -->
            <div class="setting-item">
              <label class="setting-label">
                高度網格數: {{ settings.gridCountY }}
              </label>
              <input
                type="range"
                min="2"
                max="8"
                step="1"
                [value]="settings.gridCountY"
                (input)="updateSetting('gridCountY', +$any($event.target).value)"
                class="range-input" />
            </div>

            <!-- Grid Size -->
            <div class="setting-item">
              <label class="setting-label">
                網格大小: {{ settings.gridSize }}px
              </label>
              <input
                type="range"
                min="30"
                max="100"
                step="5"
                [value]="settings.gridSize"
                (input)="updateSetting('gridSize', +$any($event.target).value)"
                class="range-input" />
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="button-group">
            <ion-button
              (click)="toggleReverse()"
              [color]="settings.isReversed ? 'primary' : 'medium'"
              fill="outline">
              <ion-icon name="swap-horizontal-outline" slot="start"></ion-icon>反轉 Reverse
            </ion-button>
            <ion-button
              (click)="openColorPicker()"
              color="primary"
              fill="outline">
              <ion-icon name="color-palette-outline" slot="start"></ion-icon>填滿 Fillings
            </ion-button>
          </div>
        </div>
      </ng-template>
    </div>
  </div>

  <!-- Content Area - Left Image + Right Grid -->
  <div class="content-area" *ngIf="uploadedImage">
    <div class="image-panel">
      <img
        [src]="uploadedImage"
        alt="Uploaded"
        class="preview-image" />
    </div>

    <div class="grid-panel">
      <app-border-grid-preview
        [uploadedImage]="uploadedImage"
        [settings]="settings">
      </app-border-grid-preview>
    </div>
  </div>

  <!-- Color Picker -->
  <app-color-picker
    *ngIf="showColorPicker"
    [initialColor]="settings.fillingColor || '#f9a8d4'"
    (colorChange)="onColorChange($event)"
    (close)="closeColorPicker()">
  </app-color-picker>

  <!-- Gallery Section -->
  <div class="gallery-section" *ngIf="galleryImages.length > 0">
    <div class="gallery-content">
      <h2 class="gallery-title">Gallery</h2>
      <div class="gallery-grid">
        <div
          *ngFor="let imageUrl of galleryImages; let i = index"
          class="gallery-item"
          [class.active]="uploadedImage === imageUrl"
          (click)="onGalleryImageClick(imageUrl)">
          <img
            [src]="imageUrl"
            [alt]="'Gallery ' + (i + 1)"
            class="gallery-thumbnail" />
        </div>
      </div>
    </div>
  </div>

  <!-- Test Block for Scroll Testing -->
  <div class="test-scroll-block">
    <div class="test-scroll-content">
      <h2 class="test-scroll-title">測試滾動區塊 (360px)</h2>
      <p>如果您能看到這個黃色區塊，表示滾動功能正常</p>
    </div>
  </div>
</div>

